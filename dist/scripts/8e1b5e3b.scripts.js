"use strict";angular.module("crocktoberApp",["ngCookies","ngResource","ngSanitize","firebase"]).value("fbURL","https://crocktoberfest.firebaseio.com/").factory("Crocks",["angularFireCollection","fbURL","$http","$q",function(a,b){return a(new Firebase(b+"crocks"))}]).factory("Categories",["angularFireCollection","fbURL",function(a,b){return a(new Firebase(b+"categories"))}]).factory("Judges",["angularFireCollection","fbURL",function(a,b){return a(new Firebase(b+"judges"))}]).factory("Session",function(){return{thisJudge:null,hasVoted:[]}}).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/results",{templateUrl:"views/result.html",controller:"ResultCtrl"}).when("/vote/:crockId",{controller:"VoteCtrl",templateUrl:"views/vote.html"}).when("/admin",{controller:"AdminCtrl",templateUrl:"views/admin.html"}).when("/leaderboard",{controller:"LeaderboardCtrl",templateUrl:"views/leaderboard.html"}).otherwise({redirectTo:"/"})}]),angular.module("crocktoberApp").controller("MainCtrl",["$q","$scope","$location","Crocks","Judges","$rootScope","Session","$timeout",function(a,b,c,d,e,f,g){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.crocks=d,b.judges=e,b.hasVoted=g.hasVoted,g.thisJudge&&(b.readyToVote=!0),b.newJudge={},b.letsGo=function(){b.judges.add(b.newJudge),g.thisJudge=b.newJudge,b.newJudge={},b.readyToVote=!0},b.hasJudgeVoted=function(a){var b=!1;return _.each(g.hasVoted,function(c){a==c.crock&&(b=!0)}),b}}]),angular.module("crocktoberApp").controller("VoteCtrl",["$scope","Categories","angularFire","$routeParams","fbURL","$rootScope","$location","Session",function(a,b,c,d,e,f,g,h){h.thisJudge||g.url("/");var i=new Firebase(e+"crocks/"+d.crockId);c(i,a,"remoteCrock",{}).then(function(){a.categories=b,a.votes=[],a.crock=angular.copy(a.remoteCrock),a.crock.$id=d.crockId,a.isClean=function(){return angular.equals(a.remoteCrock,a.crock)},a.destroy=function(){a.remoteCrock=null,g.path("/")},a.castVotes=function(){var b=[];_.each(a.votes,function(c,d){b.push({category:a.categories[d].name,weight:a.categories[d].weight,score:c,judge:h.thisJudge.name})}),console.log(h.thisJudge),a.crock.votes||(a.crock.votes=[]),a.crock.votes=a.crock.votes.concat(b),h.hasVoted.push({crock:a.crock.name}),a.save()},a.save=function(){console.log(a.crock),a.remoteCrock=angular.copy(a.crock),g.path("/")}})}]),angular.module("crocktoberApp").controller("AdminCtrl",["$scope","Crocks","Categories","Judges","$routeParams",function(a,b,c,d){a.newCrock={},a.newCategory={},a.newJudge={},a.crocks=b,a.categories=c,a.judges=d,a.addCrock=function(){a.crocks.add(a.newCrock),a.newCrock={}},a.addCategory=function(){a.categories.add(a.newCategory),a.newCategory={}},a.addJudge=function(){a.judges.add(a.newJudge),a.newJudge={}},a.removeCrock=function(b){a.crocks.remove(b)},a.removeCategory=function(b){a.categories.remove(b)},a.removeJudge=function(b){a.judges.remove(b)}}]),angular.module("crocktoberApp").controller("LeaderboardCtrl",["$scope","Crocks","$timeout",function(a,b,c){function d(a){return _.inject(a,function(a,b){return a+b})}function e(a){return Math.ceil(d(a)/a.length)}function f(a){this.name=a.name,this.votes=_.map(a.votes,function(a){return new g(a)}),this.weighteds=_.map(this.votes,function(a){return a.weightedGPA||0}),this.total=d(this.weighteds),this.weightedAverage=e(this.weighteds)}function g(a){this.category=a.category,this.score=a.score,this.weight=h[a.category],this.weightedGPA=this.score*this.weight}c(function(){a.crocks=[],_.each(b,function(b){a.crocks.push(new f(b))}),a.crocks=_.sortBy(a.crocks,function(a){return-a.weightedAverage})},1e3);var h={"Eye Flavor":10,"Sniff Quality":10,"Mouth Feel":10,"Tongue Effect":50,Overall:20}}]),angular.module("crocktoberApp").controller("ResultCtrl",["$scope","Crocks","Categories","Judges","$routeParams",function(a,b){a.crocks=b,a.getPoints=function(a){a.score=0;var b=_.groupBy(a.votes,function(a){return a.category});return _.each(b,function(b){_.each(b,function(b){if(b.score){var c=1;b.weight&&(c=parseInt(b.weight,10));var d=parseInt(b.score,10);a.score+=d*c}})}),a.score}}]);